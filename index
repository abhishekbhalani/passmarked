#!/usr/bin/env node

'use strict';

var _           = require('./lib/colours');
var pkg         = require('./package.json');
var args        = require('./lib/argv');
var stdin       = require('./lib/stdin');
var output      = require('./lib/output');
var start       = require('./lib/start');

var exitCode  = 0;
var results   = [];

process.on('beforeExit', function() {
  output(results);
  process.exit(exitCode);
}).on('log:error', function(err) {
  console.error(err.join(' '));
  exitCode = 1;
}).on('log:result', function(result) {
  results.push(result);
});

if (args.version) {
  console.log(_.inv(' âœ” passmarked: (version ' + pkg.version + ') '));
} else if (!(args._[0] || args.address)) {
  stdin.read(start);
} else {
  start([args._[0] || args.address]);
}
